## 2. 单表操作测试

### 2.1 插入

**MyBatisPlusTest**：

```java
@SpringBootTest
public class MyBatisPlusTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testInsert() {
        User user = new User();
        user.setName("张珊");
        user.setAge(18);
        user.setEmail("zs@qq.com");
        int result = userMapper.insert(user);
        System.out.println("result: " + result);
        System.out.println("user.id: " + user.getId());
    }
}
```

结果：

```
==>  Preparing: INSERT INTO user ( id, name, age, email ) VALUES ( ?, ?, ?, ? )
==> Parameters: 1544211730737479681(Long), 张珊(String), 18(Integer), zs@qq.com(String)
<==    Updates: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@5b051a5c]
result: 1
user.id: 1544211730737479681
```

### 2.2 删除

**deleteById**：

```java
@SpringBootTest
public class MyBatisPlusTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testDeleteById() {
        int result = userMapper.deleteById(1544211730737479681L);
        System.out.println("result: " + result);
    }
}
```

结果：

```
==>  Preparing: DELETE FROM user WHERE id=?
==> Parameters: 1544211730737479681(Long)
<==    Updates: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@66c38e51]
result: 1
```

**deleteByMap**：

```java
@SpringBootTest
public class MyBatisPlusTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testDeleteByMap() {
        Map<String, Object> map = new HashMap<>();
        map.put("name", "张珊");
        map.put("age", 18);
        int result = userMapper.deleteByMap(map);
        System.out.println("result: " + result);
    }
}
```

结果：

```
==>  Preparing: DELETE FROM user WHERE name = ? AND age = ?
==> Parameters: 张珊(String), 18(Integer)
<==    Updates: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4554de02]
result: 1
```

**deleteBatchIds**：

```java
@SpringBootTest
public class MyBatisPlusTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testDeleteBatchIds() {
        List<Long> list = Arrays.asList(1L, 2L, 3L);
        int result = userMapper.deleteBatchIds(list);
        System.out.println("result: " + result);
    }
}
```

结果：

```
==>  Preparing: DELETE FROM user WHERE id IN ( ? , ? , ? )
==> Parameters: 1(Long), 2(Long), 3(Long)
<==    Updates: 3
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@24934262]
result: 3
```

### 2.3 修改

**updateById**：

```java
@SpringBootTest
public class MyBatisPlusTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testUpdateById() {
        User user = new User();
        user.setId(4L);
        user.setName("李思");
        user.setEmail("lisi@qq.com");
        int result = userMapper.updateById(user);
        System.out.println("result: " + result);
    }
}
```

结果：

```
==>  Preparing: UPDATE user SET name=?, email=? WHERE id=?
==> Parameters: 李思(String), lisi@qq.com(String), 4(Long)
<==    Updates: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@639aba11]
result: 1
```

### 2.4 查询

**selectById**：

```java
@SpringBootTest
public class MyBatisPlusTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testSelectById() {
        User user = userMapper.selectById(2L);
        System.out.println("user: " + user);
    }
}
```

结果：

```
==>  Preparing: SELECT id,name,age,email FROM user WHERE id=?
==> Parameters: 2(Long)
<==    Columns: id, name, age, email
<==        Row: 2, Jack, 20, test2@baomidou.com
<==      Total: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@93f432e]
user: User(id=2, name=Jack, age=20, email=test2@baomidou.com)
```

**selectBatchIds**：

```java
@SpringBootTest
public class MyBatisPlusTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testSelectBatchIds() {
        List<Long> list = Arrays.asList(1L, 3L, 5L);
        List<User> users = userMapper.selectBatchIds(list);
        users.forEach(System.out::println);
    }
}
```

结果：

```
==>  Preparing: SELECT id,name,age,email FROM user WHERE id IN ( ? , ? , ? )
==> Parameters: 1(Long), 3(Long), 5(Long)
<==    Columns: id, name, age, email
<==        Row: 1, Jone, 18, test1@baomidou.com
<==        Row: 3, Tom, 28, test3@baomidou.com
<==        Row: 5, Billie, 24, test5@baomidou.com
<==      Total: 3
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@fabb651]
User(id=1, name=Jone, age=18, email=test1@baomidou.com)
User(id=3, name=Tom, age=28, email=test3@baomidou.com)
User(id=5, name=Billie, age=24, email=test5@baomidou.com)
```

**selectByMap**：

```java
@SpringBootTest
public class MyBatisPlusTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testSelectByMap() {
        Map<String, Object> map = new HashMap<>();
        map.put("name", "Jack");
        map.put("age", 20);
        List<User> users = userMapper.selectByMap(map);
        users.forEach(System.out::println);
    }
}
```

结果：

```
==>  Preparing: SELECT id,name,age,email FROM user WHERE name = ? AND age = ?
==> Parameters: Jack(String), 20(Integer)
<==    Columns: id, name, age, email
<==        Row: 2, Jack, 20, test2@baomidou.com
<==      Total: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@10641c09]
User(id=2, name=Jack, age=20, email=test2@baomidou.com)
```

**selectList**：

```java
@SpringBootTest
public class MyBatisPlusTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testSelectList() {
        List<User> users = userMapper.selectList(null);
        users.forEach(System.out::println);
    }
}
```

结果：

```
==>  Preparing: SELECT id,name,age,email FROM user
==> Parameters: 
<==    Columns: id, name, age, email
<==        Row: 1, Jone, 18, test1@baomidou.com
<==        Row: 2, Jack, 20, test2@baomidou.com
<==        Row: 3, Tom, 28, test3@baomidou.com
<==        Row: 4, Sandy, 21, test4@baomidou.com
<==        Row: 5, Billie, 24, test5@baomidou.com
<==      Total: 5
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6c302a1d]
User(id=1, name=Jone, age=18, email=test1@baomidou.com)
User(id=2, name=Jack, age=20, email=test2@baomidou.com)
User(id=3, name=Tom, age=28, email=test3@baomidou.com)
User(id=4, name=Sandy, age=21, email=test4@baomidou.com)
User(id=5, name=Billie, age=24, email=test5@baomidou.com)
```

### 2.5 自定义功能

**UserMapper**：

```java
@Repository
public interface UserMapper extends BaseMapper<User> {

    Map<String, Object> selectMapById(Long id);

}
```

在resources下新建mapper文件夹，然后创建**UserMapper.xml**：

```xml
<mapper namespace="com.liaoii.mybatisplus.mapper.UserMapper">
    <select id="selectMapById" resultType="map">
        select * from user where id = #{id}
    </select>
</mapper>
```

测试：

```java
@SpringBootTest
public class MyBatisPlusTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testSelectMapById() {
        Map<String, Object> map = userMapper.selectMapById(1L);
        System.out.println(map);
    }
}
```

结果：

```
==>  Preparing: select * from user where id = ?
==> Parameters: 1(Long)
<==    Columns: id, name, age, email
<==        Row: 1, Jone, 18, test1@baomidou.com
<==      Total: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@12968227]
{name=Jone, id=1, age=18, email=test1@baomidou.com}
```

### 2.6 通用Service接口

**UserService**：

```java
public interface UserService extends IService<User> {

}
```

**UserServiceImpl**：

```java
@Service
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService {

}
```

**测试类**：

```java
@SpringBootTest
public class MyBatisPlusServiceTest {

    @Autowired
    UserService userService;

    @Test
    public void test01() {
        long count = userService.count();
        System.out.println("count: " + count);
    }
}
```

结果：

```
==>  Preparing: SELECT COUNT( * ) FROM user
==> Parameters: 
<==    Columns: COUNT( * )
<==        Row: 5
<==      Total: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2d82408]
count: 5
```

**批量插入：**

**MyBatisPlusServiceTest**：

```java
@SpringBootTest
public class MyBatisPlusServiceTest {

    @Autowired
    UserService userService;

    @Test
    public void test02() {
        List<User> list = new ArrayList<>();
        for (int i = 0; i < 5; i++) {
            User user = new User();
            user.setName("LL" + i);
            user.setAge(10 + i);
            list.add(user);
        }
        boolean b = userService.saveBatch(list);
        System.out.println("result: " + b);
    }
}
```

结果：批量插入其实是分多次插入，而不是一次性插入

```
==>  Preparing: INSERT INTO user ( id, name, age ) VALUES ( ?, ?, ? )
==> Parameters: 1544318961709604866(Long), LL0(String), 10(Integer)
==> Parameters: 1544318962359721986(Long), LL1(String), 11(Integer)
==> Parameters: 1544318962359721987(Long), LL2(String), 12(Integer)
==> Parameters: 1544318962359721988(Long), LL3(String), 13(Integer)
==> Parameters: 1544318962519105537(Long), LL4(String), 14(Integer)
result: true
```

