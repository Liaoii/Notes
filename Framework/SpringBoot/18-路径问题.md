## 18. 路径问题

**路径的构成**

路径由两部分构成：资源路径与资源名称

​		路径 = 资源路径 + 资源名称

资源路径与资源名称的分水岭为：路径中的最后一个斜杠。斜杠的前面部分称为资源路径，后面部分称为资源名称。

例如：

​		请求路径：http://localhost:8080/xxx/test/index

​		资源路径：http://localhost:8080/xxx/test

​		资源名称：index

**路径的分类**

根据是否可以唯一的定位一个资源，可以将路径划分为两类：绝对路径与相对路径。

绝对路径：可以唯一的定位一个资源的路径。在 Web 应用中一般使用 URL 形式表示。

相对路径：仅依赖此路径无法唯一定位资源，但若为其指定一个参数路径，则可以将其转换为一个绝对路径，这样的路径称为相对路径。在 Web 应用中一般使用 URI 形式表示。

转换关系：绝对路径 = 参照路径 + 相对路径

**绝对路径分类**

根据路径作用的不同，可以将绝对路径分为：资源定义路径与资源请求路径。

资源定义路径：用于表示资源位置的路径。

资源请求路径：客户端所发出的对指定资源的请求路径。

**相对路径分类**

根据相对路径是否以斜杠开头，可以划分为两类：斜杠路径与非杠路径。

斜杠路径：以斜杠开头的相对路径

非杠路径：不以斜杠开头的相对路径

**斜杠路径分类**

对于斜杠路径，根据其出现的位置的不同，可以划分为前台路径与后台路径。

前台路径：出现在 HTML、JS、CSS 以及 JSP 文件的静态部分的斜杠路径。例如：

​		\<img src=""/\> 

​		\<a href=""/\> 

​		background:img("")

​		window.location.href=""

后台路径：出现在 Java 代码、JSP 文件的动态部分（Java 代码块、JSP 动作等）、XML、properties 等配置文件中的斜杠路径。

**路径解析器**

相对路径最终都会经过路径解析器，将其装换为绝对路径，以定义或定位一个资源。不同的相对路径其路径解析器也是不同的。

前台路径：路径解析器为浏览器

后台路径：路径解析器为服务器

非杠路径：若非杠路径出现在前台路径位置，其路径解析器为浏览器；若非杠路径出现在后台路径位置，其路径解析器为服务器。

**解析规则**

不同的路径解析器对同一个相对路径的解析结果是不同的。所谓解析结果指的是将相对路径所转换为的绝对路径。由于 绝对路径 = 参照路径 + 相对路径，所以不同的解析器会为相同路径匹配不同的参照路径。换句话说就是其重点是浏览器、服务器对于不同的相对路径所匹配的参照路径到底是什么。

**一般规则：**

前台路径：其参照路径为当前 web 服务器的根

后台路径：其参照路径为当前 web 应用的根

非杠路径：其参照路径为当前请求路径的资源路径

例如：

请求路径：http://localhost:8080/xxx/test/index

当前 web 服务器的根：http://localhost:8080

当前 web 应用的根：http://localhost:8080/xxx

资源路径：http://localhost:8080/xxx/test

**特例：**

在代码中使用 HttpServletResponse 的 sendRedirect() 方法使用斜杠路径进行重定向时，其参照路径按照之前规则应该是当前 web 应用的根，但实际情况是当前 web 服务器的根。

以上规则对于一次跳转是没有问题的，若跳转次数超过一次，则有可能会存在问题。



**具体分析：**

```html
<a href="/some/count">查询学生总人数</a>
```

此时当前页面的路径为：http://localhost:8888/xxx/some/index

web 服务器的根为：http://localhost:8888

所以点击该连接的路径为：http://localhost:8888/some/count

如何进行正确访问：

```html
<a th:href="|${#request.getContextPath()}/some/count|">查询学生总人数3</a>
```



```html
<a href="some/count">查询学生总人数</a>
```

此时当前页面的路径为：http://localhost:8888/xxx/some/index

资源路径为：http://localhost:8080/xxx/some

所以点击该链接的路径为：http://localhost:8888/xxx/some/some/count





```java
@GetMapping("/count")
@ResponseBody
public Integer countHandler() {
    return studentService.countStudent();
}
```

这是一个后端斜杠路径，此时参照的是 web 应用的根：http://localhost:8080/xxx

解析后的路径为：http://localhost:8080/xxx/some/count



```java
@GetMapping("redirect")
public void redirectHandler(HttpServletResponse response) throws IOException {
    response.sendRedirect("/html/welcome.html");
}
```

按理这里是一个后端斜杠路径，所以解析后的路径应该为：http://localhost:8080/xxx/html/welcome.html

但实际上是：http://localhost:8888/html/welcome.html，所以这是一个特例



```java
@GetMapping("redirect")
public void redirectHandler(HttpServletResponse response) throws IOException {
    //response.sendRedirect("/html/welcome.html");
    response.sendRedirect("html/welcome.html");
}
```

这是一个后端非杠路径，参照路径为当前请求的资源路径：http://localhost:8888/xxx/some/

解析后的路径应该为：http://localhost:8888/xxx/some/html/welcome.html



```java
@GetMapping("redirect")
    public void redirectHandler(HttpServletRequest request, HttpServletResponse response) throws IOException {
        //response.sendRedirect("/html/welcome.html");
        response.sendRedirect(request.getContextPath() + "/html/welcome.html");
    }
}
```

此时解析后的路径为：http://localhost:8888/xxx/html/welcome.html
